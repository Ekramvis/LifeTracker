<div class="task-unit group" id="task-unit-<%= task.id %>"> 
  <div class="task-description"> 
    <%= task.description %>
  </div>
  <div class="task-points">
    <%= task.value.to_s + " Points" %>
  </div> 
  <div class="task-frequency">
    <%= task.frequency == 7 ? "Daily" : task.frequency.to_s + "x/week" %>
  </div>
  <div class="completed-status" id="completed-status-<%= task.id %>" >
    <%= render partial: "/completions/completion_confirm", locals: { date_completed: Time.now.in_time_zone.to_date, task_id: task.id } %>
  </div> 
  <div class="delete-task">
    <i class="icon-trash icon-large editable" id="delete-task-<%= task.id %>"></i>
  </div>

</div>



<script>

  $(document).ready(function () { 
    
    var $deleteTaskButton = $("#delete-task-<%= task.id %>")
    var $taskUnit = $("#task-unit-<%= task.id %>")

    $deleteTaskButton.on("click", function () {

      $.ajax({
        url: "<%= goal_task_path(goal, task) %>",
        type: "delete",
        data: {
          "id": "<%= task.id %>"
        },
        success: function () {
          $taskUnit.addClass("destroyed");

          $.ajax({
            url: "/users/average_score",
            type: "get",
            data: {},
            success: function(data) {
              var $newScore = $(".current-score-container")
              $newScore.empty();
              $newScore.html(data);
            }
          })

        }
      })
    })

    var currentDate = $("#date-selector").val()

    var $dateSelector = $("#date-selector")
    var $completedStatus = $("#completed-status-<%= task.id %>")

    $dateSelector.on("change", function () {

      currentDate = $("#date-selector").val()
      
      $.ajax({
        url: "./completions/completed",
        type: "post",
        data: {
          "completion[task_id]": "<%= task.id %>",
          "completion[date_completed]": currentDate
        },
        success: function (data) {
          $completedStatus.empty();
          $completedStatus.html(data);
        }
      })

    })

  })

</script>